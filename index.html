<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>🧾 רשימת קניות שבועית</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
  box-sizing: border-box;
}
  body {
      font-family: 'Assistant', sans-serif;
      background-color: #f1f3f4;
      margin: 0;
      padding: 1rem;
      font-size: 16px;
      line-height: 1.5;
     overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 600px;
      margin: auto;
      background-color: white;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      font-size: 1rem;
    }

    @media (max-width: 600px) {
      body {
        padding: 0.5rem;
        font-size: 18px;
      }
      .container {
        padding: 1rem;
        border-radius: 0;
        box-shadow: none;
        max-width: 100%;
      }
      li {
        padding: 0.75rem 1rem;
      }
    }

    h1 {
      text-align: center;
      color: #5f6368;
    }

    .category {
      font-weight: bold;
      margin-top: 1.5rem;
      color: #673ab7; /* Google Forms purple */
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      margin: 0.5rem 0;
      background-color: #f8f9fa;
      padding: 0.5rem 1rem;
      border-radius: 5px;
    }

    .share-btn {
  position: fixed;
  bottom: 1.5rem;
  left: 1.5rem;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background-color: #25d366;
  color: white;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  z-index: 999;
}
  </style>
</head>
<body>
  <div class="container">
   <a id="whatsapp-link" class="share-btn" href="#" target="_blank" title="שלח בווטסאפ">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48">
  <path
    fill="#67C15E"
    fill-rule="evenodd"
    d="M23.993 0
       C10.763 0 0 10.765 0 24
       a23.824 23.824 0 0 0 4.57 14.067
       l-2.99 8.917
       9.224-2.948
       A23.81 23.81 0 0 0 24.007 48
       C37.237 48 48 37.234 48 24
       S37.238 0 24.007 0
       h-.014
       Z
       m-6.7 12.19
       c-.466-1.114-.818-1.156-1.523-1.185
       a13.55 13.55 0 0 0-.804-.027
       c-.918 0-1.877.268-2.455.86
       -.705.72-2.454 2.398-2.454 5.841
       s2.51 6.773 2.849 7.239
       c.353.465 4.895 7.632 11.947 10.553
       5.515 2.286 7.152 2.074 8.407 1.806
       1.834-.395 4.133-1.75 4.711-3.386
       .579-1.637.579-3.034.41-3.33
       -.17-.296-.636-.465-1.34-.818
       -.706-.353-4.134-2.046-4.783-2.272
       -.634-.24-1.24-.155-1.72.522
       -.677.946-1.34 1.905-1.876 2.483
       -.423.452-1.115.509-1.693.268
       -.776-.324-2.948-1.086-5.628-3.47
       -2.074-1.849-3.484-4.148-3.893-4.84
       -.41-.705-.042-1.114.282-1.495
       .353-.438.691-.748 1.044-1.157
       .352-.41.55-.621.776-1.1
       .24-.466.07-.946-.1-1.3
       -.168-.352-1.579-3.795-2.157-5.191Z"
  />
</svg>

</a>
    <h1>רשימת קניות</h1>
    <div id="shopping-list"></div>
  </div>

  <script>
    const SHEET_ID = "1Ilbwej4EsJYPuSKzEaDw7mRANYmND9_CzUkEAUW_I38";
    const sheetURL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    fetch(sheetURL)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;
        const cols = json.table.cols;

        // ניקח את השורה האחרונה (האחרונה שהוגשה בטופס)
        const last = rows[rows.length - 1].c;

        const container = document.getElementById("shopping-list");
        let outputHTML = "";
        let whatsappText = "📋 רשימת קניות:\n\n";

        // מתחילים מ-i=1 כדי לדלג על "חותמת זמן"
        for (let i = 1; i < last.length; i++) {
          const cell = last[i];
          if (!cell || !cell.v) continue;

          const category = cols[i].label;
          const items = cell.v.split(",").map(s => s.trim()).filter(Boolean);

          if (items.length) {
            outputHTML += `<div class="category">${category}</div><ul>`;
            items.forEach(item => {
              outputHTML += `<li>${item}</li>`;
            });
            outputHTML += `</ul>`;

            whatsappText += `${category}\n${items.map(item => "• " + item).join("\n")}\n\n`;
          }
        }

        container.innerHTML = outputHTML;

        const whatsappLink = `https://wa.me/?text=${encodeURIComponent(whatsappText)}`;
        document.getElementById("whatsapp-link").href = whatsappLink;
      })
      .catch(err => {
        document.getElementById("shopping-list").innerHTML = "❌ שגיאה בטעינת הנתונים.";
        console.error(err);
      });
  </script>
</body>
</html>
